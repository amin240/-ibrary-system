<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   
</head>
<body class="dashboard-page">
    <div class="container mt-5">
        <h2 class="text-center mb-4">ðŸ“š Library Dashboard</h2>
        <p class="text-end">
            <a href="{{ url_for('my_fines') }}" class="btn btn-warning btn-sm">My Fines</a>
            <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">Logout</a>
        </p>

        <div class="row">
            {% for book in books %}
            {% set fine_data = book_fines.get(book['id']) %}
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm {% if book['available'] == 0 %}border-danger{% else %}border-success{% endif %}">
                    <div class="card-body">
                        <h5 class="card-title">{{ book['title'] }}</h5>
                        <p>Status:
                            {% if book['available'] == 1 %}
                                <span class="text-success">Available</span>
                            {% else %}
                                <span class="text-danger">Not Available</span>
                            {% endif %}
                        </p>

                        {% if book['available'] == 1 %}
                            {% if has_unpaid_fines %}
                                <button class="btn btn-secondary btn-sm" disabled>Pay Fine First</button>
                            {% else %}
                                <a href="{{ url_for('borrow', book_id=book['id']) }}"
                                   onclick="return confirm('Borrow this book?');"
                                   class="btn btn-primary btn-sm">Borrow</a>
                            {% endif %}
                        {% else %}
                            {% if session['user_id'] in borrowed_book_users.get(book['id'], []) %}
                                {% if fine_data and fine_data.fine > 0 and fine_data.fine_paid == 0 %}
                                    <a href="{{ url_for('pay_fine_page', log_id=fine_data.log_id) }}"
                                       class="btn btn-success btn-sm">Pay</a>
                                {% endif %}
                                <a href="{{ url_for('return_book', book_id=book['id']) }}"
                                   onclick="return confirm('Return this book?');"
                                   class="btn btn-warning btn-sm">Return</a>
                            {% else %}
                                <button class="btn btn-secondary btn-sm" disabled>Not Available</button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>
